#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct Register {
    char name[30];
    int date,month,year;
    char gender[10];
    long long int accountno,phoneno;
    char mailid[30];
    char username[30];
    int password;
    float balance;
};

struct Register *members[100];
int count=0;

void viewmember(struct Register *user);
void depositamount(struct Register *user);
void withdrawamount(struct Register *user);

void member()
 {
    struct Register *p=(struct Register*)malloc(sizeof(struct Register));

    printf("Enter the name:");
    scanf("%s",p->name);
    printf("Enter the Birth Date:");
    scanf("%d",&p->date);
    printf("Enter the Birth Month:");
    scanf("%d",&p->month);
    printf("Enter the Birth Year:");
    scanf("%d",&p->year);
    printf("Enter the Gender:");
    scanf("%s",p->gender);
    printf("Enter the account number:");
    scanf("%lld",&p->accountno);
    printf("Enter the phone number:");
    scanf("%lld",&p->phoneno);
    printf("Enter the mail ID:");
    scanf("%29s", p->mailid);
    printf("Enter the username:");
    scanf("%29s", p->username);
    printf("Enter the password:");
    scanf("%d", &p->password);
    p->balance = 0.00;
    members[count++]=p;
    FILE *fptr=fopen("bank.txt","a");
    if(fptr!=NULL)
        {
        fprintf(fptr,"Name:%s\nDOB:%d/%d/%d\nGender:%s\nAccount No:%lld\nPhoneNo:%lld\nEmail:%s\nUsername:%s\nPassword:%d\nBalance:%.2f\n\n",
                p->name,p->date,p->month,p->year,p->gender,
                p->accountno,p->phoneno,p->mailid,p->username,p->password,p->balance);
        fclose(fptr);
    }
    printf("\nDETAILS ENTERED SUCCESSFULLY\n");
}

void login() {
    char uname[30];
    int pword,option;
    int found=0;
    printf("Enter the username: ");
    scanf("%s",uname);
    printf("Enter the password: ");
    scanf("%d",&pword);
    for(int i=0;i<count;i++)
        {
        if((strcmp(members[i]->username,uname)==0)&&(members[i]->password==pword))
         {
            found=1;
            do
            {
                printf("\n--- MENU ---\n");
                printf("1. View Info\n2. Deposit Amount\n3. Withdraw\n4. Logout\n");
                printf("Enter your choice: ");
                scanf("%d", &option);
            switch (option) {
                    case 1:
                        viewmember(members[i]);
                        break;
                    case 2:
                        depositamount(members[i]);
                        break;
                    case 3:
                        withdrawamount(members[i]);
                        break;
                    case 4:
                        printf("Logging out...\n");
                        break;
                    default:
                        printf("Invalid option!\n");
                }
            } while (option != 4);
        }
    }

    if (!found) {
        printf("YOU ARE NOT REGISTERED. PLEASE REGISTER.\n");
    }
}

void viewmember(struct Register *user)
 {
    printf("\n--- ACCOUNT DETAILS ---\n");
    printf("Name: %s\n", user->name);
    printf("DOB: %d/%d/%d\n", user->date, user->month, user->year);
    printf("Gender: %s\n", user->gender);
    printf("Account No: %lld\n", user->accountno);
    printf("Phone No: %lld\n", user->phoneno);
    printf("Email: %s\n", user->mailid);
    printf("Username: %s\n", user->username);
    printf("Balance: %.2f\n", user->balance);
}

void depositamount(struct Register *user) {
    int dbt=0;
    printf("Enter the amount to deposit:");
    scanf("%d",&dbt);
    user->balance+=dbt;
    printf("Total amount after deposit:Rs%.2f\n",user->balance);

    FILE *fptr=fopen("bank.txt", "a");
    if (fptr!=NULL)
        {
        fprintf(fptr,"Username:%s\nDeposited Amount:%d\nBalance:%.2f\n\n",user->username,dbt,user->balance);
        fclose(fptr);
    }
}

void withdrawamount(struct Register *user)
{
    int wdamnt;
    printf("Enter the amount to withdraw:");
    scanf("%d",&wdamnt);
    if (wdamnt>user->balance)
        {
        printf("INSUFFICIENT BALANCE\n");
    }
    else
     {
        user->balance-=wdamnt;
        printf("Total amount after withdrawal:Rs%.2f\n",user->balance);
    }

    FILE *fptr=fopen("bank.txt","a");
    if (fptr!=NULL)
        {
        fprintf(fptr,"Username:%s\nWithdrawn Amount:%d\nBalance:%.2f\n\n",user->username,wdamnt,user->balance);
        fclose(fptr);
    }
}

int main()
 {
    int choice;
    do
        {
        printf("\n--- BANKING APPLICATION ---\n");
        printf("1. Register\n2. Login\n3. Exit\n");
        printf("Enter your choice: ");
        scanf("%d",&choice);
    switch (choice)
     {
            case 1:
                member();
                break;
            case 2:
                login();
                break;
            case 3:
                printf("Exiting the application...\n");
                break;
            default:
                printf("Invalid choice!\n");
        }
    } while (choice!=3);

    return 0;
}
